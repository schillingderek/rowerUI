WindowManager:
    LoginWindow:
    MainPage:
    NewUser:

[MyLabel@Label]:
    text: ctx.text if hasattr(ctx, 'text') else ''
    color: (1,1,1,1)
    markup: True
    canvas.before:
        Color:
            rgba: (0.4, 0.6, 0.8 , 1)
        Rectangle:
            pos: self.pos
            size: self.size

<LoginWindow>:
    name: "login"
    spinner_label: spin

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1, 0.25)

            AnchorLayout:
                size_hint: (0.25, 0.75)
                anchor_x: 'left'
                MyLabel:
                    text: "User: "

            AnchorLayout:
                size_hint: (0.75, 0.75)
                padding: 2, 0, 0, 0
                anchor_x: 'left'
                Spinner:
                    id: spin
                    background_color: (0.4, 0.6, 0.8 , 1)
                    text: "Select from Dropdown"

        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1, 0.25)

            AnchorLayout:
                size_hint: (0.25, 0.75)
                anchor_x: 'left'
                MyLabel:
                    text: "Password: "


            AnchorLayout:
                size_hint: (0.75, 0.75)
                padding: 2, 0, 0, 0
                anchor_x: 'left'
                TextInput:
                    id: passw
                    multiline: False

        AnchorLayout:
            size_hint: (1, 0.1)
            Label:
                id: wrongPassword
                text: ""

        AnchorLayout:
            size_hint: (1, 0.2)
            Button:
                text: "Submit"
                size_hint: (0.75, 0.75)
                on_release:
                    wrongPassword.text = "You've entered the wrong password" if root.check_password(spin.text, passw.text) == False else ""
                    app.root.current = "mainpage" if root.check_password(spin.text, passw.text) == True else "login"
                    passw.text = ""
                    root.manager.transition.direction = "left"

        AnchorLayout:
            size_hint: (1, 0.2)
            Button:
                text: "New User"
                size_hint: (0.75, 0.75)
                pos_hint: {'center': (.5, .5)}
                on_release:
                    passw.text = ""
                    wrongPassword.text = ""
                    app.root.current = "newuser"

<MainPage>:
    name: "mainpage"
    total_time_label: total_time
    insta_time_per_500m_label: insta_time_per_500m
    total_distance_bar: total_distance_bar

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'horizontal'

            MyLabel:
                id: insta_time_per_500m
                text: "0:00:00"

            Label:
                text: "/500m"

        BoxLayout:
            orientation: 'horizontal'

            MyLabel:
                id: total_time
                text: "0:00:00"

            Label:
                text: "Total Run Time"
        BoxLayout:
            orientation: 'horizontal'
            ProgressBar:
                id: total_distance_bar
                value: 0.00
                min: 0
                max: 1
            
            Label:
                text: "Current Run"
                
        BoxLayout:
            orientation: 'horizontal'
            ProgressBar:
                id: best_run_at_distance_bar
                value: 0.33
                min: 0
                max: 1
                
            Label:
                text: "Best Run"

        Button:
            text: "Reset Run"
            on_release:
                root.reset_run()
                total_distance_bar.value = 0.00

        Button:
            text: "Go Back"
            on_release:
                app.root.current = "login"
                root.manager.transition.direction = "right"


<NewUser>:
    name: "newuser"
    user_exists_label: userExists

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'horizontal'

            AnchorLayout:
                size_hint: (0.25, 0.75)
                anchor_x: 'left'
                MyLabel:
                    text: "Name: "


            AnchorLayout:
                size_hint: (0.75, 0.75)
                padding: 10, 0, 0, 0
                anchor_x: 'left'
                TextInput:
                    id: name
                    multiline: False

        BoxLayout:
            orientation: 'horizontal'

            AnchorLayout:
                size_hint: (0.25, 0.75)
                anchor_x: 'left'
                MyLabel:
                    text: "Password: "


            AnchorLayout:
                size_hint: (0.75, 0.75)
                padding: 10, 0, 0, 0
                anchor_x: 'left'
                TextInput:
                    id: passw
                    multiline: False

        AnchorLayout:
            Label:
                id: userExists
                text: ""

        BoxLayout:
            orientation: 'horizontal'
            Button:
                text: "Go Back"
                on_release:
                    app.root.current = "login"
                    root.manager.transition.direction = "right"

            Button:
                text: "Submit"

                on_release:
                    if root.save_user(name.text, passw.text) == True: app.root.current = "mainpage"
                    else: root.user_exists_error()
